# Иван Фёдоров aka Fara Limansk


## Лабораторная работа №2

Написать “плохой” Dockerfile, в котором есть не менее трех “bad practices” по написанию докерфайлов
Написать “хороший” Dockerfile, в котором эти плохие практики исправлены
В Readme описать каждую из плохих практик в плохом докерфайле, почему она плохая и как в хорошем она была исправлена, как исправление повлияло на результат
В Readme описать 2 плохих практики по работе с контейнерами. ! Не по написанию докерфайлов, а о том, как даже используя хороший докерфайл можно накосячить именно в работе с контейнерами.

## Docker Documentation
Docker стал важным инструментом для разработки и развёртывания приложений. Однако неправильное использование Dockerfile может привести к созданию неэффективных, громоздких и небезопасных контейнеров. В данном отчёте мы создадим "плохой" Dockerfile с явными нарушениями best practices, а затем исправим его, разобрав каждую из проблем. Отчёт сопровождается детальным объяснением каждой ошибки и решений, использованных для её исправления. В конце также обсудим плохие практики при работе с контейнерами, не связанные с написанием Dockerfile.

Технологическая база

    ОС: Arch Linux, работающий через виртуальную машину.
    Docker: установленная последняя версия Docker.


Установка Docker на Arch Linux:

Вот последовательность шагов по установке:

Обновление пакетов системы: 

```bash
  sudo pacman -Syu

```
После обновления пакетов , рекомендация перезапустить ОС

Установка Docker:
```bash
  sudo pacman -S docker
```
Запуск Docker-демона xD :
```bash
  sudo systemctl start docker
  sudo systemctl enable docker
```
Добавление пользователя в группу Docker для запуска без sudo:
```bash
  sudo usermod -aG docker $USER

```




## "Плохой" Dockerfile 

У нас есть Dockerfile с плохими практиками , вот его пример:



!["Плохой" Докер](https://imgur.com/a/HwShtqm)

Листинг с комментариями:




```bash
  # Плохой Dockerfile
FROM ubuntu:latest  # Использование непредсказуемого тега latest

# Установка зависимостей
RUN apt-get update && apt-get install -y python3  # Кэш не очищен

# Копирование всех файлов из текущей директории
COPY . /app  # Копирование всего, что может включать ненужные файлы

# Запуск приложения
CMD python3 /app/app.py
```


## Разберем ошибки 

1) Использование ubuntu:latest: использование тега latest не гарантирует стабильность и предсказуемость образа. Это может вызвать неожиданные ошибки в будущем, если образ обновится.

2) Неочищенный кэш после установки пакетов: при установке пакетов через apt-get кэш остаётся в системе, что приводит к увеличению размера образа.

3) Копирование всей директории через COPY . /app: копирование всех файлов из текущей директории включает ненужные файлы, такие как .git, временные файлы и логи.




# "Хороший" Dockerfile

Теперь давайте создадим исправленный "хороший" Dockerfile, который будет решать проблемы из "плохого" Dockerfile.

### Пример "хорошего" Dockerfile:

```bash
# Хороший Dockerfile
FROM ubuntu:20.04  # (1) Используем конкретную версию Ubuntu

# Установка зависимостей и очистка кэша
RUN apt-get update && apt-get install -y python3 && rm -rf /var/lib/apt/lists/*  # (2) Удаляем кэш для уменьшения размера образа

# Копируем только необходимые файлы
COPY app.py /app/app.py  # (3) Копируем только app.py, а не всю директорию

# Запуск приложения
CMD ["python3", "/app/app.py"]

```
### Исправления:
1) Используем конкретную версию Ubuntu: мы заменили ubuntu:latest на ubuntu:20.04, что гарантирует стабильность и предсказуемость образа.
2) Удаление кэша после установки пакетов: добавлена команда rm -rf /var/lib/apt/lists/*, чтобы удалить кэш пакетов, тем самым значительно уменьшая размер образа.
3) Копируем только нужные файлы: вместо копирования всей директории, мы копируем только файл app.py, что делает образ легче и предотвращает попадание ненужных файлов в контейнер.

# Сборка и запуск контейнеров
Теперь, когда у нас есть "хороший" Dockerfile, давайте соберем и запустим контейнер:
### Сборка образа:
```bash
docker build -t good-dockerfile .

```
### Запуск контейнера:

```bash
docker run good-dockerfile
```



# Плохие практики при работе с контейнерами
Помимо плохих практик при написании Dockerfile, есть несколько распространённых ошибок при работе с контейнерами, даже если Dockerfile написан правильно:

1) Запуск контейнеров с правами root: По умолчанию, контейнеры могут запускаться с правами суперпользователя root, что представляет угрозу безопасности. Это может позволить злоумышленнику получить доступ к системе хоста, если контейнер будет взломан. Решение: запускайте контейнеры с ограниченными правами пользователей с помощью USER в Dockerfile или флага --user при запуске контейнера.

2) Отсутствие использования volumes: Если данные записываются напрямую в контейнер, они будут потеряны при его удалении. Это часто случается, когда разработчики забывают о том, что контейнеры являются временными по своей природе. Решение: для сохранения данных используйте volumes, что позволит сохранять данные вне контейнера и восстанавливать их при перезапуске контейнера.

# Заключение

### В этом проекте мы рассмотрели процесс создания "плохого" Dockerfile, выявили три распространённые ошибки и исправили их в "хорошем" Dockerfile. Также мы обсудили две распространённые плохие практики при работе с контейнерами. Docker предоставляет много гибких инструментов для создания эффективных и безопасных контейнеров, но требует осторожного и продуманного подхода к написанию Dockerfile и работе с контейнерами.

#### Docker — это мощный инструмент, но как и любой инструмент, он требует правильного использования. Надеюсь, данный отчёт поможет избежать распространённых ошибок и повысить качество ваших контейнеров.